---
layout: default
---

<h1 class="text-center text-xl"> Site Stats  </h1>
<br>

<!-- I will be updating these soon. -->

<div class="flex justify-center px-4 py-16">

    <div class="grid grid-cols-1 md:grid-cols-3">
      
        <div class="card bg-primary text-primary-content mr-1 mb-1">
            <div class="card-body">
                <h2 class="card-title">Most Visited pages</h2>
                
                <div class="">
                  <ul id="popular-pages"></ul>
                </div>
            </div>
        </div>
    </div>  

    <div class="grid grid-cols-1 md:grid-cols-3">
      
      <div class="card bg-primary text-primary-content mr-1 mb-1">
          <div class="card-body">
              <h2 class="card-title">Most Downloaded Files</h2>
              
              <div class="">
                <ul id="popular-downloads"></ul>
              </div>
          </div>
      </div>
  </div> 
        
</div>

<script>
 
  function loadStats() {

    // Fetch and display top 10 popular pages
    db.ref('page_loads')
      .orderByChild('count')  // Order by count (ascending)
      .limitToLast(10)        // Get the last 10 (highest counts)
      .once('value')          // Fetch data once
      .then((snapshot) => {
        const pagesList = document.getElementById('popular-pages');
        let pagesArray = [];

        snapshot.forEach((childSnapshot) => {
          pagesArray.push({
            url: childSnapshot.key,         // Page URL (key)
            count: childSnapshot.val().count // Page count
          });
        });

        // Reverse to get highest counts first
        pagesArray.reverse();

        // Display results
        pagesList.innerHTML = ''; // Clear existing list
        pagesArray.forEach((page) => {
          pagesList.innerHTML += `<li>${page.url}: ${page.count} views</li>`;
        });
      })
      .catch((error) => {
        console.error('Error fetching popular pages:', error);
      });
    // Fetch and display popular downloads

    db.ref('downloads').once('value').then((snapshot) => {
      const downloadsData = snapshot.val();
      const downloadsList = document.getElementById('popular-downloads');
      const allDownloads = [];

      // Flatten the nested structure
      for (const section in downloadsData) {
        for (const fileName in downloadsData[section]) {
          allDownloads.push({
            path: `${section}/${fileName}`,
            count: downloadsData[section][fileName],
          });
        }
      }

      // Sort by count (descending)
      allDownloads.sort((a, b) => b.count - a.count);

      // Display top 10 downloads
      allDownloads.slice(0, 10).forEach((download) => {
        downloadsList.innerHTML += `<li>${download.path}: ${download.count} downloads</li>`;
      });
    });
  }
  document.addEventListener("DOMContentLoaded", loadStats);
</script>
